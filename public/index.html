<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExpressEcho</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>ExpressEcho</h1>
        
        <div class="section">
            <h2>Add New Message</h2>
            <div class="form-group">
                <input type="text" id="messageInput" placeholder="Enter your message" />
                <button onclick="addMessage()">Send</button>
            </div>
        </div>

        <div class="section">
            <h2>Messages</h2>
            <button onclick="fetchMessages()" class="refresh-btn">Refresh Messages</button>
            <div id="messagesList" class="messages-container">
                <!-- Messages will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Fetch and display messages when the page loads
        document.addEventListener('DOMContentLoaded', fetchMessages);

        // Function to fetch and display messages
        async function fetchMessages() {
            try {
                const response = await fetch('/api/messages');
                const messages = await response.json();
                
                const messagesList = document.getElementById('messagesList');
                messagesList.innerHTML = '';
                
                if (messages.length === 0) {
                    messagesList.innerHTML = '<p class="no-messages">No messages yet. Add one above!</p>';
                    return;
                }
                
                messages.forEach(msg => {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'message';
                    
                    const date = new Date(msg.timestamp);
                    const formattedDate = date.toLocaleString();
                    
                    messageElement.innerHTML = `
                        <div class="message-header">
                            <span class="message-id">#${msg.id}</span>
                            <span class="message-time">${formattedDate}</span>
                        </div>
                        <div class="message-text">${msg.text}</div>
                    `;
                    
                    messagesList.appendChild(messageElement);
                });
            } catch (error) {
                console.error('Error fetching messages:', error);
                alert('Failed to load messages. Please try again.');
            }
        }

        // Function to add a new message
        async function addMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) {
                alert('Please enter a message');
                return;
            }
            
            try {
                const response = await fetch('/api/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: message })
                });
                
                if (response.ok) {
                    input.value = ''; // Clear the input
                    fetchMessages(); // Refresh the messages
                } else {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to add message');
                }
            } catch (error) {
                console.error('Error adding message:', error);
                alert('Failed to add message: ' + error.message);
            }
        }

        // Allow submitting with Enter key
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addMessage();
            }
        });
    </script>
</body>
</html>
